# Архітектура, методологія та компоненти

Розуміння архітектури OpenSTEF допоможе вам отримати уявлення про те, як
використовувати цей програмний пакет та краще зрозуміти решту
документації.

## Архітектура програмного забезпечення

OpenSTEF створений як пакет Python, який виконує машинне навчання з
метою прогнозування енергетичних навантажень на енергосистему.

<img src="software_arch.png" width="830" alt="image" />

OpenSTEF складається з:

-   **Prediction job** (Передбачення): вхідну конфігурацію для завдання
    та/або трубопроводу (наприклад, натренувати модель XGB для певної
    локації).
-   **Tasks** (Завдання): можна викликати для навчання, прогнозування
    або оцінювання. Всі завдання використовують відповідні трубопроводи.
    Завдання включають отримання даних з бази даних, виклик винятків
    завдання та запис даних до бази даних.
-   **Pipelines** (Трубопроводи): можна викликати для навчання,
    прогнозування або оцінювання шляхом надаючи вхідні дані до
    трубопроводу. Користувачі можуть використовувати завдання (які
    отримують/записують дані за вас), або використовувати безпосередньо
    трубопроводи (що вимагає самостійного отримання/запису даних).
-   **Data validation** (Підтвердження даних): викликається
    трубопроводами для перевірки даних (наприклад, для перевірки
    наявності рівнинних ділянок).
-   **Feature engineering** (Розробка функцій): викликається
    трубопроводами для вибору необхідних об'єктів для
    навчання/прогнозування на основі конфігурації із завдання
    прогнозування (наприклад, створення нових об'єктів для енергетичного
    навантаження за вчорашній день, минулий тиждень).
-   **Machine learning** (Машинне навчання): викликається трубопроводами
    для виконання навчання, прогнозування або оцінювання на основі
    конфігурації із завдання прогнозування (наприклад, навчання
    квантильної моделі XGB).
-   **Model storage** (Зберігання моделей): викликається трубопроводами
    для зберігання або отримання навченої моделі машинного навчання за
    допомогою MLFlow (наприклад, зберігати модель локально в
    disk/database/s3_bucket на AWS).
-   **Post processing** (Подальша обробка): викликається трубопроводами
    для постпрогнозування (наприклад, об'єднання прогнозного фрейму
    даних з додатковою інформацією про конфігурацію із завдання
    прогнозування або розділення прогнозу навантаження на прогноз
    сонячної, вітрової енергії та прогноз використання енергії).

Завдання надаються в окремому пакеті Python під назвою
[openstef-dbc](https://pypi.org/project/openstef-dbc/). Якщо вам
потрібно використовувати завдання, потрібен пакет openstef-dbc для
інтерфейсу з базами даних для читання/запису. Наразі openstef-dbc
підтримує інтерфейси для бази даних MySQL для даних конфігурації
(наприклад, інформація для завдань прогнозування) і
[InfluxDB](https://www.influxdata.com/) для функціональних даних
(наприклад, даних про погоду, навантаження, ціни на енергоносії) та
даних прогнозу енергоспоживання.

## Архітектура Додатку

OpenSTEF - це просто програмний пакет (тобто бібліотека Python). Якщо ви
хочете запустити його як повноцінний додаток з графічним інтерфейсом
користувача, ви повинні розгорнути його з додатковими компонентами.

<img
src="https://user-images.githubusercontent.com/25053215/184536367-c7914697-7a2a-45b8-b447-36aec1a6c1af.png"
width="800" alt="image" />

Ось рекомендовані додаткові компоненти, якщо ви хочете запустити його як
додаток:

-   Репозиторії на Github:
    -   (створить самі) **Data fetcher**: програмний пакет для отримання
        вхідних даних і запису їх до бази даних (напр. запланований
        [CronJob](https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/)
        для отримання даних про погоду в Kubernetes).
    -   (створить самі) **Data API**: API для надання даних з бази даних
        або іншого джерела додаткам і користувачам (наприклад, REST
        API).
    -   (створить самі) **Forecaster**: програмний пакет для отримання
        конфігурації/даних та запуску завдань/трубопроводів OpenSTEF
        (наприклад, заплановане завдання cron для навчання/прогнозування
        в Kubernetes).
    -   (відкрите джерело) **OpenSTEF**: програмний пакет, який здійснює
        машинне навчання для прогнозування енергетичних навантажень на
        енергосистему.
    -   (відкрите джерело) **OpenSTEF-dbc**: програмний пакет, який
        надає інтерфейс для читання/запису даних з/до бази даних для
        задач openstef.
-   CI/CD Infrastructure
    -   (створить самі) **Energy forecasting Application CI/CD**:
        Трубопровід безперервної інтеграції/безперервної доставки для
        побудови, тестування та розгортання вашого додатку для
        прогнозування (наприклад, до Kubernetes через Jenkins, Chef,
        Puppet, Tekton тощо).
    -   (відкрите джерело) **OpenSTEF package CI/CD**: Набір дій GitHub,
        які збирають, тестують та публікують пакет OpenSTEF до PyPI
        [тут](https://pypi.org/project/openstef/) коли настане час
        випустити нову версію.
-   **Compute**: обчислювальні ресурси для запуску ваших трубопроводів і
    завдань у виробництві (наприклад, на Kubernetes з використанням
    будь-якого з різних провайдерів AWS, Azure, GCP, Linode і т.д.).
-   **Database**: SQL, InfluxDB або інша база даних, яка зберігає
    отримані вхідні дані та прогнози.
-   **Dashboard**: графічний інтерфейс користувача, що дозволяє
    користувачам візуалізувати дані програми (наприклад, історичні та
    прогнозовані енергетичні навантаження).
